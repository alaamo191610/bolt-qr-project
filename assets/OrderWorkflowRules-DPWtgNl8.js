import{r as d,a as j,j as e}from"./index-FBn7Kh98.js";import{D as u}from"./defaults-By8L-jCx.js";function f({children:r,className:l=""}){return e.jsx("span",{className:`px-2.5 py-1 rounded-full text-sm border bg-white ${l}`,children:r})}function k({label:r,children:l}){return e.jsxs("div",{className:"grid grid-cols-12 items-center gap-3 py-2",children:[e.jsx("div",{className:"col-span-4 text-sm text-slate-700",children:r}),e.jsx("div",{className:"col-span-8",children:l})]})}function M({adminId:r}){const[l,c]=d.useState(u),[y,h]=d.useState(!0),[p,b]=d.useState(!1),[m,i]=d.useState(!1);d.useEffect(()=>{let s=!0;return(async()=>{h(!0);try{const a=await j.getAdminSettings(r),t=a==null?void 0:a.order_rules;c(t&&Object.keys(t).length?t:u),i(!1)}catch(a){console.error(a),c(u)}finally{s&&h(!1)}})(),()=>{s=!1}},[r]);const x=d.useMemo(()=>l.statuses.map(s=>s.key),[l]),o=(s,a)=>{c(t=>({...t,statuses:t.statuses.map(n=>n.key===s?{...n,...a}:n)})),i(!0)},g=(s,a)=>{c(t=>{const n=[...t.statuses],[w]=n.splice(s,1);return n.splice(a,0,w),{...t,statuses:n}}),i(!0)},N=(s,a)=>{c(t=>{const n=new Set(t.transitions[s]);return n.has(a)?n.delete(a):n.add(a),{...t,transitions:{...t.transitions,[s]:Array.from(n)}}}),i(!0)},v=async()=>{b(!0);try{await j.saveOrderRules(r,l),i(!1)}catch(s){alert("Failed to save: "+(s==null?void 0:s.message))}finally{b(!1)}};return y?e.jsx("div",{className:"p-6 rounded-xl border bg-white",children:"Loading order rules…"}):e.jsxs("section",{className:"bg-white rounded-xl border shadow-sm p-6 space-y-6",children:[e.jsx("header",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Order Workflow Rules"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Define statuses, transitions, and SLAs. These apply across Menu, KDS, and Receipts."})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-slate-800",children:"Statuses"}),e.jsx("div",{className:"divide-y border rounded-xl",children:l.statuses.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-center p-3",children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("button",{className:"w-8 h-8 rounded-md border bg-white disabled:opacity-40",onClick:()=>g(a,Math.max(0,a-1)),disabled:a===0,"aria-label":"Move up",children:"↑"}),e.jsx("button",{className:"w-8 h-8 rounded-md border bg-white disabled:opacity-40",onClick:()=>g(a,Math.min(l.statuses.length-1,a+1)),disabled:a===l.statuses.length-1,"aria-label":"Move down",children:"↓"}),e.jsx(f,{children:s.key})]}),e.jsxs("div",{className:"col-span-4 flex items-center gap-2",children:[e.jsx("input",{className:"w-full border rounded-md px-2 py-1",value:s.label_en,onChange:t=>o(s.key,{label_en:t.target.value}),placeholder:"Label (EN)"}),e.jsx("input",{className:"w-full border rounded-md px-2 py-1",value:s.label_ar,onChange:t=>o(s.key,{label_ar:t.target.value}),placeholder:"Label (AR)"})]}),e.jsxs("div",{className:"col-span-3 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!s.customerVisible,onChange:t=>o(s.key,{customerVisible:t.target.checked})}),"Customer visible"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!s.notify,onChange:t=>o(s.key,{notify:t.target.checked})}),"Notify"]})]}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"SLA (min)"}),e.jsx("input",{type:"number",min:0,className:"w-24 border rounded-md px-2 py-1 text-right",value:s.slaMin??0,onChange:t=>o(s.key,{slaMin:Math.max(0,Number(t.target.value||0))})})]})]},s.key))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-slate-800",children:"Allowed Transitions"}),e.jsx("div",{className:"overflow-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-[640px] w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[e.jsx("th",{className:"p-2 text-left",children:"From ↓ / To →"}),x.map(s=>e.jsx("th",{className:"p-2",children:s},s))]})}),e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium text-slate-800",children:e.jsx(f,{children:s})}),x.map(a=>{var t;return e.jsx("td",{className:"p-2 text-center",children:s===a?e.jsx("span",{className:"text-slate-300",children:"—"}):e.jsx("input",{type:"checkbox",checked:((t=l.transitions[s])==null?void 0:t.includes(a))||!1,onChange:()=>N(s,a)})},s+a)})]},s))})]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(k,{label:"Auto-cancel PENDING after (min)",children:e.jsx("input",{type:"number",min:0,className:"w-28 border rounded-md px-2 py-1 text-right",value:l.autoCancelAfterMin??0,onChange:s=>{const a=Math.max(0,Number(s.target.value||0));c(t=>({...t,autoCancelAfterMin:a})),i(!0)}})})}),e.jsx("footer",{className:"pt-2",children:e.jsx("button",{onClick:v,disabled:!m||p,className:`px-4 py-2 rounded-lg text-sm font-medium border shadow-sm ${m?"bg-emerald-600 text-white border-emerald-700":"bg-slate-100 text-slate-500 border-slate-200"}`,children:p?"Saving…":m?"Save changes":"Saved"})})]})}export{M as default};
